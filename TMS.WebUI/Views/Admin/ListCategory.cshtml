@using TMS.WebApp.HtmlHelpers
@using TMS.Domain.Common;
@using TMS.WebApp.Services;

@model TMS.Domain.Entities.Category[]
@{
    ViewBag.Title = "Quản lý Danh mục";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Danh sách Danh mục</h2>
        @if (User.Identity != null && User.Identity.IsAuthenticated)
        {
        }
    </div>
    <div class="col-lg-2">

    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        <div class="ibox">
            <div class="ibox-content">
                <input type="button" class="btn btn-default btn-sm" style="margin-bottom: 15px;" value="Thêm danh mục" data-toggle="modal" id="btn-add-user" onclick="getAddCategoryModal()" data-target="#modal-add-user" />
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                            <tr>
                                <th>Tên Danh mục</th>
                                <th>Tên Danh mục cha</th>
                                <th>Giá trị</th>
                                <th>Phân loại danh mục</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var a in @Model)
                            {
                                <tr>
                                    <td class="col-lg-1">@a.CategoryName</td>
                                    <td class="col-lg-1">@(a.ParentCategory == null ? String.Empty : a.ParentCategory.CategoryName)</td>
                                    <td class="col-lg-1">@a.CatValue</td>
                                    <td class="col-lg-1">@CategoryService.GetInstance().GetCategoryName(@a.CatType, Contain.CatType.CategoryType)</td>
                                    <td class="col-lg-2">
                                        <input type="button" data-toggle="modal" class="btn btn-default btn-sm" value="Sửa" data-id="@a.CatID" onclick="getEditCategoryModal('@a.CatID')" />
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>




<!-- Add Category Modal -->
<div class="modal fade inmodal" tabindex="-1" role="dialog" aria-hidden="true" style="overflow:auto" aria-labelledby="gridSystemModalLabel" id="modal-add-category">
    <div class="modal-dialog modal-lg">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">
                <h4 class="modal-title text-left">Thêm danh mục</h4>
            </div>
            <div id="container-add-category">
            </div>
        </div>

    </div>
</div>
<!-- End Add Category Modal -->
<!-- Update Category Modal -->
<div class="modal fade inmodal" tabindex="-1" role="dialog" aria-hidden="true" style="overflow:auto" aria-labelledby="gridSystemModalLabel" id="modal-edit-category">
    <div class="modal-dialog modal-lg">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">
                <h4 class="modal-title text-left">Sửa danh mục</h4>
            </div>
            <div id="container-edit-category">
            </div>
        </div>

    </div>
</div>
<!-- End Update Category Modal -->
<!-- Delete Category Modal -->
@using (Html.BeginForm("DeleteCategory", "Admin", FormMethod.Post))
{ 
<div class="modal fade inmodal" id="modal-delete-category" role="dialog" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog" style="position: initial;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title text-center">
                   Bạn có chắc muốn xóa danh mục <span id="span-category"></span>?    
                    <input type="hidden" value="" id="span-catid" name="catid"/>
                </h4>
            </div>
            <div class="modal-body">
                <div class="success">
                    <div class="form-group" style="text-align:center">
                        <input type="button" value="Hủy" class="btn btn-white reset-button" data-dismiss="modal" />
                        <input type="submit" value="Xóa" class="btn btn-primary" />
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
}
<!-- End Delete Category Modal -->
<script>
    function getAddCategoryModal() {
        $.ajax({

            type: "POST",
            url: "@Url.Action("AddCategory", "Admin")",
            success: function (content) {
                $("#modal-add-category").modal('show');
                $("#container-add-category").html(content);
            },
            error: function (e) { }
        });
    }
    function getEditCategoryModal(catid) {
        $.ajax({

            type: "POST",
            url: "@Url.Action("EditCategory", "Admin")" + "?catid=" + catid,
            success: function (content) {
                $("#modal-edit-category").modal('show');
                $("#container-edit-category").html(content);
            },
            error: function (e) {
                console.log("modal fail");
            }
        });
    }

    function getDeleteCategoryModal(catid, catname) {
        $.ajax({

            type: "POST",
            url: "@Url.Action("DeleteCategory", "Admin")",
            success: function (content) {
                $("#modal-delete-user").modal('show');
                $("#span-username").text(catname);
                $("#span-uid").text(catid);
            },
        error: function (e) { }
        });
    }

</script>
